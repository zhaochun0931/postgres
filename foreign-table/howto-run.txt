# pg2 is remote postgres


docker exec -it pg2 bash

su - postgres

createdb test

psql test


CREATE TABLE customers (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email TEXT
);

INSERT INTO customers (name, email) 
VALUES
('Alice', 'alice@example.com'),
('Bob', 'bob@example.com'),
('Charlie', 'charlie@example.com');



select * from customers;












docker exec -it pg1 bash

su - postgres

createdb test

psql test






This example uses the built-in postgres_fdw to access a table on a separate PostgreSQL server. 

-- 1. Enable the postgres_fdw extension
CREATE EXTENSION postgres_fdw;

-- 2. Create a foreign server definition
CREATE SERVER foreign_pg_server FOREIGN DATA WRAPPER postgres_fdw OPTIONS (host 'pg2', dbname 'test', port '5432');



-- 3. Create a user mapping for the current user, map local user to remote user
CREATE USER MAPPING FOR postgres SERVER foreign_pg_server OPTIONS (user 'postgres', password 'password');

-- 4. Create the foreign table
-- Create a foreign table pointing to remote.customers
CREATE FOREIGN TABLE remote_customers (
    id INT,
    name TEXT,
    email TEXT
) 
SERVER foreign_pg_server
OPTIONS (schema_name 'public', table_name 'customers');





-- Query the remote table!
SELECT * FROM remote_customers;


test=# SELECT * FROM remote_customers;
 id |  name   |        email
----+---------+---------------------
  1 | Alice   | alice@example.com
  2 | Bob     | bob@example.com
  3 | Charlie | charlie@example.com
(3 rows)

test=#













-- Local table
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INT,
    amount NUMERIC
);

INSERT INTO orders (customer_id, amount) VALUES
(1, 100.0),
(2, 200.0);

-- Join local orders with remote customers
SELECT o.order_id, c.name, o.amount
FROM orders o
JOIN remote_customers c ON o.customer_id = c.id;


test=# SELECT o.order_id, c.name, o.amount
FROM orders o
JOIN remote_customers c ON o.customer_id = c.id;
 order_id | name  | amount
----------+-------+--------
        1 | Alice |  100.0
        2 | Bob   |  200.0
(2 rows)

test=#


