pg_dropcluster 17 test1 --stop
pg_createcluster 17 test1





su - postgres

mkdir mybackup mywal




postgresql.conf


archive_mode = on
archive_command = 'cp %p /var/lib/postgresql/mywal/%f'





pg_ctlcluster 17 test1 start








su - postgres

psql 

CREATE DATABASE test;
\c test

CREATE TABLE t1(id int primary key, balance int);
INSERT INTO t1 VALUES (1,100), (2,200), (3,300);
select * from t1;

SELECT pg_switch_wal();

SELECT now();


DELETE FROM t1 WHERE id=2;









pg_basebackup -D /var/lib/postgresql/mybackup -Fp -Xs -P


-Fp → plain format (files).

-Xs → include WAL stream.

This backup is our starting point.







pg_ctlcluster 17 test1 stop

rm -Rf /var/lib/postgresql/17/test1/*

cp -R /var/lib/postgresql/mybackup/* /var/lib/postgresql/17/test1


touch recovery.signal



restore_command = 'cp /var/lib/postgresql/mywal/%f %p'



